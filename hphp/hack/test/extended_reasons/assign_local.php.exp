error: Typing[4110] Invalid argument

  9 | function bar(Super $f): void {
 10 |   $g = $f;
 11 |   foo(»$g«);
 12 | }

File "assign_local.php", line 11, character 7 - line 11, character 8:

Expected `Sub`

 3 | class Super {}
 4 | class Sub extends Super {}
 5 |
 6 |
 7 | function foo(»Sub« $_): void {}
 8 |
 9 | function bar(Super $f): void {

File "assign_local.php", line 7, character 14 - line 7, character 16:

But got `Super`

 9 | function bar(»Super« $f): void {
10 |   $g = $f;
11 |   foo($g);
12 | }

File "assign_local.php", line 9, character 14 - line 9, character 18:

Step 1 of 2

I started by checking this subtype relationship.

The subtype comes from this function or method declaration

 3 | class Super {}
 4 | class Sub extends Super {}
 5 |
 6 |
 7 | function »foo«(Sub $_): void {}
 8 |
 9 | function bar(Super $f): void {

File "assign_local.php", line 7, character 10 - line 7, character 12:

The supertype comes from this expression

  9 | function bar(Super $f): void {
 10 |   $g = $f;
 11 |   »foo($g)«;
 12 | }

File "assign_local.php", line 11, character 3 - line 11, character 9:

Step 2 of 2

These are function types so next I checked the 1st function parameter of the supertype and subtype were subtypes (functions are contravariant in their parameters so the direction of the subtype relationship is reversed).

This step is the cause of the error.

The subtype comes from this hint

 9 | function bar(»Super« $f): void {
10 |   $g = $f;
11 |   foo($g);
12 | }

File "assign_local.php", line 9, character 14 - line 9, character 18:

which is defined here

 3 | class »Super« {}
 4 | class Sub extends Super {}

File "assign_local.php", line 3, character 7 - line 3, character 11:

and flows into this expression as the parameter hint

 9 | function bar(Super »$f«): void {
10 |   $g = $f;
11 |   foo($g);
12 | }

File "assign_local.php", line 9, character 20 - line 9, character 21:

which itself flows into this expression as the type of the local variable

 9 | function bar(Super $f): void {
10 |   $g = »$f«;
11 |   foo($g);
12 | }

File "assign_local.php", line 10, character 8 - line 10, character 9:

which itself flows into this expression via an assignment

 9 | function bar(Super $f): void {
10 |   »$g« = $f;
11 |   foo($g);
12 | }

File "assign_local.php", line 10, character 3 - line 10, character 4:

which itself flows into this expression as the type of the local variable

  9 | function bar(Super $f): void {
 10 |   $g = $f;
 11 |   foo(»$g«);
 12 | }

File "assign_local.php", line 11, character 7 - line 11, character 8:

The supertype comes from this hint

 3 | class Super {}
 4 | class Sub extends Super {}
 5 |
 6 |
 7 | function foo(»Sub« $_): void {}
 8 |
 9 | function bar(Super $f): void {

File "assign_local.php", line 7, character 14 - line 7, character 16:

which is defined here

 3 | class Super {}
 4 | class »Sub« extends Super {}
 5 |
 6 |
 7 | function foo(Sub $_): void {}
 8 |
 9 | function bar(Super $f): void {

File "assign_local.php", line 4, character 7 - line 4, character 9:

1 error found.
